<?xml version="1.0" encoding="utf-8"?>
<ResourceDictionary x:Class="MediaTrackMixer.Resources.Template"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:viewModels="using:MediaTrackMixerPage.ViewModels"
    xmlns:converters="using:CommunityToolkit.WinUI.Converters"
    xmlns:resources="using:MediaTrackMixer.Resources"
    xmlns:textToTimeSpan="using:TextToTimeSpan"
    xmlns:helpers="using:WinUIShared.Helpers">

    <ResourceDictionary.MergedDictionaries>
        <ResourceDictionary Source="ms-appx:///Resources/WinUISharedDictionary.xaml"/>
    </ResourceDictionary.MergedDictionaries>

    <converters:BoolNegationConverter x:Key="BoolNegationConverter" />
    <converters:BoolToVisibilityConverter x:Key="BoolToVisibilityConverter"/>
    <converters:BoolToObjectConverter x:Key="BoolToNegatedVisibilityConverter" TrueValue="Collapsed" FalseValue="Visible"/>
    <converters:StringVisibilityConverter x:Key="StringVisibilityConverter"/>
    <converters:EmptyObjectToObjectConverter x:Key="EmptyObjectToObjectConverter" EmptyValue="Collapsed" NotEmptyValue="Visible"/>
    <helpers:EnumToVisibilityConverter x:Key="EnumToVisibilityConverter" EnumType="viewModels:TrackType" EnumForVisibility="Attachment"/>
    <helpers:DoubleToVisibilityConverter x:Key="DoubleToVisibilityConverter"/>
    <textToTimeSpan:TimeSpanToTextConverter x:Key="TimeSpanToTextConverter"/>

    <Style x:Name="ExpanderButton" TargetType="ToggleButton" BasedOn="{StaticResource DefaultToggleButtonStyle}">
        <Setter Target="Background" Value="{ThemeResource TextControlButtonBackground}"/>
        <Setter Target="BorderBrush" Value="{ThemeResource TextControlButtonBorderBrush}"/>
        <Setter Property="Template">
            <Setter.Value>
                <ControlTemplate TargetType="ToggleButton">
                    <Border x:Name="Grid" Background="{TemplateBinding Background}" BackgroundSizing="{TemplateBinding BackgroundSizing}" BorderBrush="{TemplateBinding BorderBrush}" BorderThickness="{TemplateBinding BorderThickness}" CornerRadius="{TemplateBinding CornerRadius}" Padding="{TemplateBinding Padding}" AutomationProperties.AccessibilityView="Raw">
                        <VisualStateManager.VisualStateGroups>
                            <VisualStateGroup x:Name="CommonStates">
                                <VisualState x:Name="Normal" >
                                </VisualState>
                                <VisualState x:Name="PointerOver">
                                    <VisualState.Setters>
                                        <Setter Target="Grid.Background" Value="{ThemeResource TextControlButtonBackgroundPointerOver}"/>
                                        <Setter Target="Grid.BorderBrush" Value="{ThemeResource TextControlButtonBorderBrushPointerOver}"/>
                                    </VisualState.Setters>
                                </VisualState>
                                <VisualState x:Name="CheckedPointerOver">
                                    <VisualState.Setters>
                                        <Setter Target="Grid.Background" Value="{ThemeResource TextControlButtonBackgroundPointerOver}"/>
                                        <Setter Target="Grid.BorderBrush" Value="{ThemeResource TextControlButtonBorderBrushPointerOver}"/>
                                        <Setter Target="FontIcon.Glyph" Value="&#xE70E;"></Setter>
                                    </VisualState.Setters>
                                </VisualState>
                                <VisualState x:Name="Pressed">
                                    <VisualState.Setters>
                                        <Setter Target="Grid.Background" Value="{ThemeResource TextControlButtonBackgroundPressed}"/>
                                        <Setter Target="Grid.BorderBrush" Value="{ThemeResource TextControlButtonBorderBrushPressed}"/>
                                    </VisualState.Setters>
                                </VisualState>
                                <VisualState x:Name="CheckedPressed">
                                    <VisualState.Setters>
                                        <Setter Target="Grid.Background" Value="{ThemeResource TextControlButtonBackgroundPressed}"/>
                                        <Setter Target="Grid.BorderBrush" Value="{ThemeResource TextControlButtonBorderBrushPressed}"/>
                                        <Setter Target="FontIcon.Glyph" Value="&#xE70E;"></Setter>
                                    </VisualState.Setters>
                                </VisualState>
                                <VisualState x:Name="Checked">
                                    <VisualState.Setters>
                                        <Setter Target="FontIcon.Glyph" Value="&#xE70E;"></Setter>
                                    </VisualState.Setters>
                                </VisualState>
                            </VisualStateGroup>
                        </VisualStateManager.VisualStateGroups>
                        <FontIcon x:Name="FontIcon" Glyph="&#xE70D;"/>
                    </Border>
                </ControlTemplate>
            </Setter.Value>
        </Setter>
    </Style>

    <Style x:Name="RemoveButton" TargetType="Button" BasedOn="{StaticResource DefaultButtonStyle}">
        <Setter Target="Background" Value="{ThemeResource TextControlButtonBackground}"/>
        <Setter Target="BorderBrush" Value="{ThemeResource TextControlButtonBorderBrush}"/>
        <Setter Property="Template">
            <Setter.Value>
                <ControlTemplate TargetType="Button">
                    <Border x:Name="Grid" Background="{TemplateBinding Background}" BackgroundSizing="{TemplateBinding BackgroundSizing}" BorderBrush="{TemplateBinding BorderBrush}" BorderThickness="{TemplateBinding BorderThickness}" CornerRadius="{TemplateBinding CornerRadius}" Padding="{TemplateBinding Padding}" AutomationProperties.AccessibilityView="Raw">
                        <VisualStateManager.VisualStateGroups>
                            <VisualStateGroup x:Name="CommonStates">
                                <VisualState x:Name="Normal" >
                                </VisualState>
                                <VisualState x:Name="PointerOver">
                                    <VisualState.Setters>
                                        <Setter Target="Grid.Background" Value="{ThemeResource TextControlButtonBackgroundPointerOver}"/>
                                        <Setter Target="Grid.BorderBrush" Value="{ThemeResource TextControlButtonBorderBrushPointerOver}"/>
                                    </VisualState.Setters>
                                </VisualState>
                                <VisualState x:Name="Pressed">
                                    <VisualState.Setters>
                                        <Setter Target="Grid.Background" Value="{ThemeResource TextControlButtonBackgroundPressed}"/>
                                        <Setter Target="Grid.BorderBrush" Value="{ThemeResource TextControlButtonBorderBrushPressed}"/>
                                    </VisualState.Setters>
                                </VisualState>
                            </VisualStateGroup>
                        </VisualStateManager.VisualStateGroups>
                        <FontIcon x:Name="FontIcon" Glyph="&#xE711;" FontSize="{StaticResource SmallFontSize}"/>
                    </Border>
                </ControlTemplate>
            </Setter.Value>
        </Setter>
    </Style>

    <Style x:Key="DefaultExpanderStyle" TargetType="Expander">
        <Setter Property="MinHeight" Value="0" />
        <Setter Property="Padding" Value="0" />
        <Setter Property="HorizontalAlignment" Value="Stretch" />
        <Setter Property="Template">
            <Setter.Value>
                <ControlTemplate TargetType="Expander">
                    <Grid MinWidth="{TemplateBinding MinWidth}" MaxWidth="{TemplateBinding MaxWidth}">
                        <VisualStateManager.VisualStateGroups>
                            <VisualStateGroup x:Name="ExpandStates">
                                <VisualState x:Name="ExpandUp">
                                    <VisualState.Storyboard>
                                        <Storyboard>
                                            <ObjectAnimationUsingKeyFrames Storyboard.TargetName="ExpanderContent" Storyboard.TargetProperty="Visibility">
                                                <DiscreteObjectKeyFrame KeyTime="0" Value="Visible" />
                                            </ObjectAnimationUsingKeyFrames>
                                            <DoubleAnimationUsingKeyFrames Storyboard.TargetName="ExpanderContent" Storyboard.TargetProperty="(UIElement.RenderTransform).(CompositeTransform.TranslateY)">
                                                <DiscreteDoubleKeyFrame KeyTime="0" Value="{Binding RelativeSource={RelativeSource TemplatedParent}, Path=TemplateSettings.ContentHeight}" />
                                                <SplineDoubleKeyFrame KeyTime="0:0:0.333" Value="0" KeySpline="0.0, 0.0, 0.0, 1.0" />
                                            </DoubleAnimationUsingKeyFrames>
                                        </Storyboard>
                                    </VisualState.Storyboard>
                                </VisualState>
                                <VisualState x:Name="CollapseDown">
                                    <VisualState.Storyboard>
                                        <Storyboard>
                                            <ObjectAnimationUsingKeyFrames Storyboard.TargetName="ExpanderContent" Storyboard.TargetProperty="Visibility">
                                                <DiscreteObjectKeyFrame KeyTime="0:0:0.2" Value="Collapsed" />
                                            </ObjectAnimationUsingKeyFrames>
                                            <DoubleAnimationUsingKeyFrames Storyboard.TargetName="ExpanderContent" Storyboard.TargetProperty="(UIElement.RenderTransform).(CompositeTransform.TranslateY)">
                                                <DiscreteDoubleKeyFrame KeyTime="0" Value="0" />
                                                <SplineDoubleKeyFrame KeyTime="0:0:0.167" Value="{Binding RelativeSource={RelativeSource TemplatedParent}, Path=TemplateSettings.ContentHeight}" KeySpline="1.0, 1.0, 0.0, 1.0" />
                                            </DoubleAnimationUsingKeyFrames>
                                        </Storyboard>
                                    </VisualState.Storyboard>
                                </VisualState>
                                <VisualState x:Name="ExpandDown">
                                    <VisualState.Storyboard>
                                        <Storyboard>
                                            <ObjectAnimationUsingKeyFrames Storyboard.TargetName="ExpanderContent" Storyboard.TargetProperty="Visibility">
                                                <DiscreteObjectKeyFrame KeyTime="0" Value="Visible" />
                                            </ObjectAnimationUsingKeyFrames>
                                            <DoubleAnimationUsingKeyFrames Storyboard.TargetName="ExpanderContent" Storyboard.TargetProperty="(UIElement.RenderTransform).(CompositeTransform.TranslateY)">
                                                <DiscreteDoubleKeyFrame KeyTime="0" Value="{Binding RelativeSource={RelativeSource TemplatedParent}, Path=TemplateSettings.NegativeContentHeight}" />
                                                <SplineDoubleKeyFrame KeyTime="0:0:0.333" Value="0" KeySpline="0.0, 0.0, 0.0, 1.0" />
                                            </DoubleAnimationUsingKeyFrames>
                                        </Storyboard>
                                    </VisualState.Storyboard>
                                </VisualState>
                                <VisualState x:Name="CollapseUp">
                                    <VisualState.Storyboard>
                                        <Storyboard>
                                            <ObjectAnimationUsingKeyFrames Storyboard.TargetName="ExpanderContent" Storyboard.TargetProperty="Visibility">
                                                <DiscreteObjectKeyFrame KeyTime="0:0:0.167" Value="Collapsed" />
                                            </ObjectAnimationUsingKeyFrames>
                                            <DoubleAnimationUsingKeyFrames Storyboard.TargetName="ExpanderContent" Storyboard.TargetProperty="(UIElement.RenderTransform).(CompositeTransform.TranslateY)">
                                                <DiscreteDoubleKeyFrame KeyTime="0" Value="0" />
                                                <SplineDoubleKeyFrame KeyTime="0:0:0.167" Value="{Binding RelativeSource={RelativeSource TemplatedParent}, Path=TemplateSettings.NegativeContentHeight}" KeySpline="1.0, 1.0, 0.0, 1.0" />
                                            </DoubleAnimationUsingKeyFrames>
                                        </Storyboard>
                                    </VisualState.Storyboard>
                                </VisualState>
                            </VisualStateGroup>
                            <VisualStateGroup x:Name="ExpandDirectionStates">
                                <VisualState x:Name="Down" />
                                <VisualState x:Name="Up">
                                    <VisualState.Setters>
                                        <Setter Target="ExpanderHeader.Style" Value="{StaticResource ExpanderHeaderUpStyle}" />
                                        <Setter Target="ExpanderContent.BorderThickness" Value="{StaticResource ExpanderContentUpBorderThickness}" />
                                        <Setter Target="ExpanderContent.CornerRadius" Value="{Binding CornerRadius, RelativeSource={RelativeSource TemplatedParent}, Converter={StaticResource TopCornerRadiusFilterConverter}}" />
                                        <Setter Target="ExpanderHeader.(Grid.Row)" Value="1" />
                                        <Setter Target="ExpanderContentClip.(Grid.Row)" Value="0" />
                                        <Setter Target="Row0.Height" Value="*" />
                                        <Setter Target="Row1.Height" Value="Auto" />
                                    </VisualState.Setters>
                                </VisualState>
                            </VisualStateGroup>
                        </VisualStateManager.VisualStateGroups>
                        <Grid.RowDefinitions>
                            <RowDefinition x:Name="Row0" Height="Auto" />
                            <RowDefinition x:Name="Row1" Height="*" />
                        </Grid.RowDefinitions>
                        <ContentPresenter
                            x:Name="ExpanderHeader"
                            Content="{TemplateBinding Header}"
                            ContentTemplate="{TemplateBinding HeaderTemplate}"
                            Padding="{TemplateBinding Padding}"
                            HorizontalAlignment="Stretch"/>
                        <Border x:Name="ExpanderContentClip" Grid.Row="1">
                            <Border x:Name="ExpanderContent" Visibility="Collapsed" Background="{TemplateBinding Background}" BackgroundSizing="{TemplateBinding BackgroundSizing}" CornerRadius="{Binding CornerRadius, RelativeSource={RelativeSource TemplatedParent}, Converter={StaticResource BottomCornerRadiusFilterConverter}}" BorderBrush="{TemplateBinding BorderBrush}" BorderThickness="{StaticResource ExpanderContentDownBorderThickness}" MinHeight="{TemplateBinding MinHeight}" HorizontalAlignment="Stretch" VerticalAlignment="Stretch" Padding="{TemplateBinding Padding}">
                                <ContentPresenter Content="{TemplateBinding Content}" ContentTemplate="{TemplateBinding ContentTemplate}" ContentTemplateSelector="{TemplateBinding ContentTemplateSelector}" HorizontalContentAlignment="{TemplateBinding HorizontalContentAlignment}" VerticalContentAlignment="{TemplateBinding VerticalContentAlignment}" />
                                <Border.RenderTransform>
                                    <CompositeTransform />
                                </Border.RenderTransform>
                            </Border>
                        </Border>
                    </Grid>
                </ControlTemplate>
            </Setter.Value>
        </Setter>
    </Style>

    <DataTemplate x:Key="TrackTemplate" x:DataType="viewModels:Track">
        <Expander IsExpanded="{Binding ElementName=Toggle, Path=IsChecked}" Style="{StaticResource DefaultExpanderStyle}" HorizontalContentAlignment="Stretch">
            <Expander.Header>
                <Grid Height="40" BorderBrush="{ThemeResource TextFillColorPrimaryBrush}" BorderThickness="1"
                  Background="{ThemeResource ListItemBackground}">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="60" />
                        <ColumnDefinition Width="60" />
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="Auto" />
                    </Grid.ColumnDefinitions>
                    <Grid ToolTipService.ToolTip="{x:Bind FileNameString}">
                        <Ellipse Fill="{x:Bind Colour.Background}" Stroke="{ThemeResource TextFillColorPrimaryBrush}"
                             Width="30" Height="30"/>
                        <TextBlock VerticalAlignment="Center" HorizontalAlignment="Center" FontSize="22"
                               Text="{x:Bind IndexString}" Foreground="{x:Bind Colour.Foreground}" />
                    </Grid>
                    <FontIcon Grid.Column="1" Glyph="{x:Bind Icon}" ToolTipService.ToolTip="{x:Bind ToolTip}" />
                    <Grid Grid.Column="2" ColumnDefinitions="Auto, Auto" VerticalAlignment="Stretch"
                          Visibility="{x:Bind BindingProxy.OnSecondPage, Mode=OneWay, Converter={StaticResource BoolToNegatedVisibilityConverter}}">
                        <TextBlock VerticalAlignment="Center" Text="{x:Bind PassedTitle.Title}" TextTrimming="CharacterEllipsis"/>
                        <FontIcon Grid.Column="1" Glyph="&#xF13E;" Visibility="{x:Bind PassedDefault.IsDefault, Mode=OneWay}" ToolTipService.ToolTip="Marked default" HorizontalAlignment="Left"/>
                    </Grid>
                    <Grid Grid.Column="2" VerticalAlignment="Stretch"
                          Visibility="{x:Bind BindingProxy.OnSecondPage, Mode=OneWay, Converter={StaticResource BoolToVisibilityConverter}}">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto" />
                            <ColumnDefinition Width="Auto" />
                            <ColumnDefinition Width="Auto" />
                        </Grid.ColumnDefinitions>
                        <Grid Visibility="{x:Bind InEditMode, Mode=OneWay, Converter={StaticResource BoolToNegatedVisibilityConverter}}">
                            <TextBlock VerticalAlignment="Center" Visibility="{x:Bind PassedTitle.Title, Converter={StaticResource StringVisibilityConverter}, ConverterParameter=True, Mode=OneWay}"
                                   Foreground="{ThemeResource TextFillColorDisabledBrush}" FontStyle="Italic">
                            (No Title)
                            </TextBlock>
                            <TextBlock VerticalAlignment="Center" Text="{x:Bind PassedTitle.Title, Mode=OneWay}" TextTrimming="CharacterEllipsis"
                                   Visibility="{x:Bind PassedTitle.Title, Converter={StaticResource StringVisibilityConverter}, Mode=OneWay}" />
                        </Grid>
                        <TextBox Text="{x:Bind PassedTitle.Title, Mode=TwoWay}" Visibility="{x:Bind InEditMode, Mode=OneWay}"
                             VerticalAlignment="Center" HorizontalAlignment="Stretch" />
                        <ToggleButton Grid.Column="1" Margin="10,0,0,0" Click="TitleEdit" Visibility="{x:Bind IsNotChapter}">
                            <SymbolIcon Symbol="Edit" />
                        </ToggleButton>
                        <FontIcon Grid.Column="2" Glyph="&#xF13E;" Visibility="{x:Bind PassedDefault.IsDefault, Mode=OneWay}" ToolTipService.ToolTip="Marked default"/>
                    </Grid>
                    <TextBlock Grid.Column="3" VerticalAlignment="Center" HorizontalAlignment="Right"
                           Text="{x:Bind CodecOrMimeType}" Margin="10,0" />
                    <ToggleButton Grid.Column="4" Name="Toggle" Content="Yoo" Style="{StaticResource ExpanderButton}"/>
                </Grid>
            </Expander.Header>
            <Expander.Content>
                <ContentControl Content="{x:Bind Data}" ContentTemplateSelector="{StaticResource TrackDataTemplateSelector}" HorizontalAlignment="Stretch" HorizontalContentAlignment="Stretch"
                                Margin="0,10"/>
            </Expander.Content>
        </Expander>
    </DataTemplate>

    <resources:TrackDataTemplateSelector x:Key="TrackDataTemplateSelector"
                                         TrackEditTemplate="{StaticResource TrackEditTemplate}"
                                         MetadataEditTemplate="{StaticResource MetadataTemplate}"
                                         ChaptersEditTemplate="{StaticResource ChaptersEditTemplate}"/>

    <x:Double x:Key="SmallHeight">27</x:Double>
    <x:Double x:Key="SmallFontSize">12</x:Double>
    <Style x:Key="SmallTextBox" TargetType="TextBox" BasedOn="{StaticResource DefaultTextBoxStyle}">
        <Setter Property="FontSize" Value="{StaticResource SmallFontSize}"/>
        <Setter Property="Height" Value="{StaticResource SmallHeight}"/>
        <Setter Property="MinHeight" Value="0"/>
    </Style>
    <Style x:Key="EditTitle" TargetType="TextBlock" BasedOn="{StaticResource CaptionTextBlockStyle}">
        <Setter Property="Foreground" Value="{ThemeResource TextFillColorSecondaryBrush}"/>
        <Setter Property="HorizontalTextAlignment" Value="Center"/>
        <Setter Property="FontWeight" Value="Bold"/>
    </Style>

    <DataTemplate x:Key="MetadataItem" x:DataType="viewModels:MetadataItem">
        <Grid ColumnDefinitions="2*, Auto, 3*, Auto">
            <TextBlock VerticalAlignment="Center" Text="{x:Bind Key, Mode=OneWay}" TextTrimming="CharacterEllipsis"
                       Visibility="{Binding Source={StaticResource GlobalBindingProxy}, Path=OnSecondPage, Converter={StaticResource BoolToNegatedVisibilityConverter}}"
                       FontSize="{StaticResource SmallFontSize}" TextAlignment="Right"/>
            <TextBox Text="{x:Bind Key, Mode=TwoWay}" Style="{StaticResource SmallTextBox}" TextAlignment="Right" IsEnabled="{x:Bind CantEdit, Converter={StaticResource BoolNegationConverter}}"
                     Visibility="{Binding Source={StaticResource GlobalBindingProxy}, Path=OnSecondPage, Converter={StaticResource BoolToVisibilityConverter}}"/>
            <TextBlock Grid.Column="1" VerticalAlignment="Center" Margin="5,0">:</TextBlock>
            <TextBlock Grid.Column="2" VerticalAlignment="Center" Text="{x:Bind Value, Mode=OneWay}" TextTrimming="CharacterEllipsis" FontSize="{StaticResource SmallFontSize}"
                       Visibility="{Binding Source={StaticResource GlobalBindingProxy}, Path=OnSecondPage, Converter={StaticResource BoolToNegatedVisibilityConverter}}" />
            <TextBox Grid.Column="2" Text="{x:Bind Value, Mode=TwoWay}" Style="{StaticResource SmallTextBox}" IsEnabled="{x:Bind CantEdit, Converter={StaticResource BoolNegationConverter}}"
                     Visibility="{Binding Source={StaticResource GlobalBindingProxy}, Path=OnSecondPage, Converter={StaticResource BoolToVisibilityConverter}}" />
            <Button Grid.Column="3" Visibility="{Binding Source={StaticResource GlobalBindingProxy}, Path=OnSecondPage, Converter={StaticResource BoolToVisibilityConverter}}"
                    Command="{Binding DataContext.DeleteItemCommand, ElementName=ItemsList}" CommandParameter="{Binding}" Height="{StaticResource SmallHeight}"
                    Margin="5,0,0,0" IsEnabled="{x:Bind CantEdit, Converter={StaticResource BoolNegationConverter}}" ToolTipService.ToolTip="Remove entry">
                <SymbolIcon Symbol="Clear"/>
            </Button>
        </Grid>
    </DataTemplate>

    <DataTemplate x:Key="MetadataTemplate" x:DataType="viewModels:MetadataEdit">
        <Grid RowDefinitions="Auto, Auto, Auto" RowSpacing="5">
            <TextBlock Style="{ThemeResource EditTitle}">Metadata</TextBlock>
            <ListView Grid.Row="1" x:Name="ItemsList" SelectionMode="None" ItemsSource="{x:Bind}" ItemTemplate="{StaticResource MetadataItem}">
                <ListView.ItemContainerStyle>
                    <Style TargetType="ListViewItem" BasedOn="{StaticResource DefaultListViewItemStyle}">
                        <Setter Property="MinHeight" Value="30"/>
                    </Style>
                </ListView.ItemContainerStyle>
            </ListView>
            <Button Grid.Row="2" Width="100" HorizontalAlignment="Center" Click="AddMetadata" Height="{StaticResource SmallHeight}" ToolTipService.ToolTip="Add entry"
                    Visibility="{Binding Source={StaticResource GlobalBindingProxy}, Path=OnSecondPage, Converter={StaticResource BoolToVisibilityConverter}}">
                <StackPanel Orientation="Horizontal" Spacing="10">
                    <SymbolIcon Symbol="Add" />
                </StackPanel>
            </Button>
        </Grid>
    </DataTemplate>

    <DataTemplate x:Key="TrackEditTemplate" x:DataType="viewModels:TrackEdit">
        <Grid RowSpacing="10">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>
            <ContentPresenter Content="{x:Bind Metadata}" ContentTemplate="{StaticResource MetadataTemplate}"/>
            <Grid Grid.Row="1" Visibility="{Binding Source={StaticResource GlobalBindingProxy}, Path=OnSecondPage, Converter={StaticResource BoolToNegatedVisibilityConverter}}">
                <Grid RowDefinitions="Auto, Auto" RowSpacing="5" Visibility="{x:Bind DispositionLength, Mode=OneWay, Converter={StaticResource DoubleToVisibilityConverter}}">
                    <TextBlock Style="{ThemeResource EditTitle}">Disposition</TextBlock>
                    <TextBlock Grid.Row="1" Text="{x:Bind DispositionString, Mode=OneWay}" FontSize="{StaticResource SmallFontSize}" TextAlignment="Center"/>
                </Grid>
            </Grid>
            <Grid Grid.Row="1" RowDefinitions="Auto, Auto" RowSpacing="5"
                  Visibility="{Binding Source={StaticResource GlobalBindingProxy}, Path=OnSecondPage, Converter={StaticResource BoolToVisibilityConverter}}">
                <TextBlock Style="{ThemeResource EditTitle}">Disposition</TextBlock>
                <ItemsRepeater Grid.Row="1" ItemsSource="{x:Bind Dispositions}">
                    <ItemsRepeater.Layout>
                        <UniformGridLayout Orientation="Horizontal" ItemsJustification="Center" ItemsStretch="None" MaximumRowsOrColumns="4"/>
                    </ItemsRepeater.Layout>
                    <ItemsRepeater.ItemTemplate>
                        <DataTemplate x:DataType="viewModels:DispositionItem">
                            <CheckBox Content="{x:Bind Key}" IsChecked="{x:Bind Checked, Mode=TwoWay}" Style="{StaticResource SmallCheckBoxStyle}"
                                      FontSize="{StaticResource SmallFontSize}" Height="17" MinHeight="0"/>
                        </DataTemplate>
                    </ItemsRepeater.ItemTemplate>
                </ItemsRepeater>
            </Grid>
            <Grid Grid.Row="2" Visibility="{Binding Source={StaticResource GlobalBindingProxy}, Path=OnSecondPage, Converter={StaticResource BoolToVisibilityConverter}}">
                <Grid RowDefinitions="Auto, Auto" RowSpacing="5" Visibility="{x:Bind Sync.Type, Converter={StaticResource EnumToVisibilityConverter}, ConverterParameter=True}">
                    <TextBlock Style="{ThemeResource EditTitle}">Sync</TextBlock>
                    <StackPanel Grid.Row="1" Orientation="Horizontal" Spacing="10" HorizontalAlignment="Center">
                        <ListView ItemsSource="{x:Bind Sync.Options}" SelectedItem="{x:Bind Sync.SelectedOption, Mode=TwoWay}" HorizontalAlignment="Center"
                                  VerticalAlignment="Center" FontSize="{StaticResource SmallFontSize}">
                            <ListView.ItemsPanel>
                                <ItemsPanelTemplate>
                                    <StackPanel Orientation="Horizontal"/>
                                </ItemsPanelTemplate>
                            </ListView.ItemsPanel>
                            <ListView.ItemContainerStyle>
                                <Style TargetType="ListViewItem" BasedOn="{StaticResource SmallRadioButtons}">
                                    <Setter Property="FontSize" Value="{StaticResource SmallFontSize}"/>
                                    <Setter Property="MinWidth" Value="0"/>
                                </Style>
                            </ListView.ItemContainerStyle>
                        </ListView>
                        <textToTimeSpan:TimeSpanTextBox Value="{x:Bind Sync.Change, Mode=TwoWay}" MinHeight="0" IsEnabled="{x:Bind Sync.EnableChangeTextBox, Mode=OneWay}"
                                                        Height="{StaticResource SmallHeight}" FontSize="{StaticResource SmallFontSize}" VerticalAlignment="Center"/>
                    </StackPanel>
                </Grid>
            </Grid>
        </Grid>
    </DataTemplate>

    <DataTemplate x:Key="ChaptersEditTemplate" x:DataType="viewModels:ChaptersEdit">
        <Grid RowDefinitions="Auto, Auto, Auto" RowSpacing="5">
            <Grid.Resources>
                <DataTemplate x:Key="SecondPageTemplate" x:DataType="viewModels:ChapterEdit">
                    <Expander HorizontalAlignment="Stretch" MinHeight="0" Padding="5">
                        <Expander.Header>
                            <Grid ColumnDefinitions="*, Auto, Auto, Auto, Auto" ColumnSpacing="5">
                                <TextBlock Text="{x:Bind PassedTitle.Title, Mode=OneWay}" TextTrimming="CharacterEllipsis" FontSize="{StaticResource SmallFontSize}" VerticalAlignment="Center"/>
                                <textToTimeSpan:TimeSpanTextBox Grid.Column="1" Value="{x:Bind Start, Mode=TwoWay}" Height="{StaticResource SmallHeight}"
                                                                FontSize="{StaticResource SmallFontSize}" MinHeight="0" VerticalAlignment="Center"/>
                                <TextBlock Grid.Column="2" FontSize="{StaticResource SmallFontSize}" VerticalAlignment="Center">to</TextBlock>
                                <textToTimeSpan:TimeSpanTextBox Grid.Column="3" Value="{x:Bind End, Mode=TwoWay}" Height="{StaticResource SmallHeight}"
                                                                FontSize="{StaticResource SmallFontSize}" MinHeight="0" VerticalAlignment="Center"/>
                                <Button Grid.Column="4" Style="{StaticResource RemoveButton}" Height="{StaticResource SmallHeight}"
                                        Command="{Binding DataContext.DeleteItemCommand, ElementName=ItemsList}" CommandParameter="{Binding}"/>
                            </Grid>
                        </Expander.Header>
                        <Expander.Content>
                            <ContentPresenter Content="{x:Bind Metadata}" ContentTemplate="{StaticResource MetadataTemplate}"/>
                        </Expander.Content>
                    </Expander>
                </DataTemplate>
                <DataTemplate x:Key="NotSecondPageTemplate" x:DataType="viewModels:ChapterEdit">
                    <Grid ColumnDefinitions="*, 80, Auto, 80" ColumnSpacing="10">
                        <TextBlock Grid.Column="0" Text="{x:Bind PassedTitle.Title, Mode=OneWay}" TextTrimming="CharacterEllipsis" FontSize="{StaticResource SmallFontSize}" VerticalAlignment="Center"/>
                        <TextBlock Grid.Column="1" Text="{x:Bind Start, Mode=OneWay, Converter={StaticResource TimeSpanToTextConverter}}" FontSize="{StaticResource SmallFontSize}"
                                   VerticalAlignment="Center" TextAlignment="Right"/>
                        <TextBlock Grid.Column="2" FontSize="{StaticResource SmallFontSize}" VerticalAlignment="Center">to</TextBlock>
                        <TextBlock Grid.Column="3" Text="{x:Bind End, Mode=OneWay, Converter={StaticResource TimeSpanToTextConverter}}" FontSize="{StaticResource SmallFontSize}"
                                   VerticalAlignment="Center"/>
                    </Grid>
                </DataTemplate>
                <converters:BoolToObjectConverter x:Key="ChapTemplateConverter" FalseValue="{StaticResource NotSecondPageTemplate}" TrueValue="{StaticResource SecondPageTemplate}"/>
            </Grid.Resources>
            <TextBlock Style="{ThemeResource EditTitle}">Chapters</TextBlock>
            <ListView x:Name="ItemsList" Grid.Row="1" ItemsSource="{x:Bind}" SelectionMode="None"
                      ItemTemplate="{Binding Source={StaticResource GlobalBindingProxy}, Path=OnSecondPage, Converter={StaticResource ChapTemplateConverter}}">
                <ListView.ItemContainerStyle>
                    <Style TargetType="ListViewItem" BasedOn="{StaticResource DefaultListViewItemStyle}">
                        <Setter Property="MinHeight" Value="30"/>
                    </Style>
                </ListView.ItemContainerStyle>
            </ListView>
            <Button Grid.Row="2" Width="100" HorizontalAlignment="Center" Click="AddChapter" Height="{StaticResource SmallHeight}" ToolTipService.ToolTip="Add entry"
                    Visibility="{Binding Source={StaticResource GlobalBindingProxy}, Path=OnSecondPage, Converter={StaticResource BoolToVisibilityConverter}}">
                <StackPanel Orientation="Horizontal" Spacing="10">
                    <SymbolIcon Symbol="Add" />
                </StackPanel>
            </Button>
        </Grid>
    </DataTemplate>
</ResourceDictionary>
